<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rocket Dodge</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
      color: white;
    }
    #gameArea {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    #rocket {
      position: absolute;
      width: 40px;
      height: 40px;
      background: red;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 5px;
    }
    .bullet {
      position: absolute;
      width: 10px;
      height: 20px;
      background: white;
      top: 0;
    }
    .powerup {
      position: absolute;
      width: 20px;
      height: 20px;
      background: cyan;
      border-radius: 50%;
      top: 0;
    }
    #scoreBoard {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      z-index: 10;
    }
    #pauseBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      padding: 8px 16px;
      font-size: 16px;
    }
    #controls {
      position: absolute;
      bottom: 60px;
      width: 100%;
      z-index: 10;
      pointer-events: none;
    }
    .control-btn {
      padding: 30px;
      font-size: 32px;
      background: #333;
      color: white;
      border: none;
      border-radius: 10px;
      pointer-events: all;
    }
    #leftBtn {
      position: absolute;
      left: 20px;
      bottom: 60px;
    }
    #rightBtn {
      position: absolute;
      right: 20px;
      bottom: 60px;
    }
    #retryBtn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 12px 24px;
      font-size: 18px;
      display: none;
      z-index: 11;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <div id="rocket"></div>
    <div id="scoreBoard">Score: 0 | Lives: 3 | Level: 1 | High Score: 0</div>
    <button id="pauseBtn">Pause</button>
    <button id="retryBtn">Retry</button>
    <div id="controls">
      <button id="leftBtn" class="control-btn">◀️</button>
      <button id="rightBtn" class="control-btn">▶️</button>
    </div>
  </div>

  <audio id="hitSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

  <script>
    const gameArea = document.getElementById("gameArea");
    const rocket = document.getElementById("rocket");
    const scoreBoard = document.getElementById("scoreBoard");
    const pauseBtn = document.getElementById("pauseBtn");
    const retryBtn = document.getElementById("retryBtn");
    const hitSound = document.getElementById("hitSound");

    let bullets = [];
    let powerups = [];
    let score = 0;
    let highScore = localStorage.getItem("highScore") || 0;
    let level = 1;
    let lives = 3;
    let bulletSpeed = 4;
    let rocketSpeed = 10;
    let leftPressed = false;
    let rightPressed = false;
    let isPaused = false;
    let powerupActive = false;
    let powerupTimer = null;
    let animationId;

    function startGame() {
      score = 0;
      lives = 3;
      level = 1;
      bulletSpeed = 4;
      isPaused = false;
      bullets = [];
      powerups = [];
      rocket.style.left = "50%";
      retryBtn.style.display = "none";
      updateScore();
      spawnBullet();
      spawnPowerup();
      animate();
    }

    function updateScore() {
      scoreBoard.textContent = `Score: ${score} | Lives: ${lives} | Level: ${level} | High Score: ${highScore}`;
    }

    function spawnBullet() {
      if (isPaused) return;

      const bullet = document.createElement("div");
      bullet.classList.add("bullet");
      bullet.style.left = Math.random() * (window.innerWidth - 10) + "px";
      bullet.style.top = "0px";
      gameArea.appendChild(bullet);
      bullets.push({ el: bullet, x: bullet.offsetLeft, y: 0 });

      setTimeout(spawnBullet, 800 - level * 20);
    }

    function spawnPowerup() {
      if (isPaused || powerupActive) return;

      const powerup = document.createElement("div");
      powerup.classList.add("powerup");
      powerup.style.left = Math.random() * (window.innerWidth - 20) + "px";
      gameArea.appendChild(powerup);

      powerups.push({ el: powerup, x: powerup.offsetLeft, y: 0 });

      setTimeout(spawnPowerup, 8000 + Math.random() * 8000);
    }

    function activatePowerup() {
      if (powerupActive) return;
      powerupActive = true;
      navigator.vibrate?.([100, 50, 100]);
      const originalSpeed = bulletSpeed;
      bulletSpeed = 2;
      rocket.style.background = "yellow";

      if (powerupTimer) clearTimeout(powerupTimer);
      powerupTimer = setTimeout(() => {
        bulletSpeed = originalSpeed;
        rocket.style.background = "red";
        powerupActive = false;
      }, 5000);
    }

    function animate() {
      if (isPaused) {
        cancelAnimationFrame(animationId);
        return;
      }

      bullets.forEach((b, i) => {
        b.y += bulletSpeed;
        b.el.style.top = b.y + "px";

        const r = rocket.getBoundingClientRect();
        const br = b.el.getBoundingClientRect();

        if (
          !powerupActive &&
          br.top < r.bottom &&
          br.bottom > r.top &&
          br.left < r.right &&
          br.right > r.left
        ) {
          gameArea.removeChild(b.el);
          bullets.splice(i, 1);
          lives--;
          hitSound.currentTime = 0;
          hitSound.play();
          navigator.vibrate?.(100);
          updateScore();
          if (lives <= 0) {
            gameOver();
            return;
          }
        }

        if (b.y > window.innerHeight) {
          b.el.remove();
          bullets.splice(i, 1);
          score++;
          if (score % 10 === 0) {
            level++;
            bulletSpeed += 0.5;
          }
          updateScore();
        }
      });

      powerups.forEach((p, i) => {
        p.y += bulletSpeed / 2;
        p.el.style.top = p.y + "px";

        const r = rocket.getBoundingClientRect();
        const pr = p.el.getBoundingClientRect();

        if (
          pr.top < r.bottom &&
          pr.bottom > r.top &&
          pr.left < r.right &&
          pr.right > r.left
        ) {
          activatePowerup();
          p.el.remove();
          powerups.splice(i, 1);
        }

        if (p.y > window.innerHeight) {
          p.el.remove();
          powerups.splice(i, 1);
        }
      });

      const rocketX = rocket.offsetLeft;
      if (leftPressed && rocketX > 0) {
        rocket.style.left = rocketX - rocketSpeed + "px";
      }
      if (rightPressed && rocketX < window.innerWidth - rocket.offsetWidth) {
        rocket.style.left = rocketX + rocketSpeed + "px";
      }

      animationId = requestAnimationFrame(animate);
    }

    function gameOver() {
      cancelAnimationFrame(animationId);
      navigator.vibrate?.([200, 100, 200]);
      retryBtn.style.display = "block";
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("highScore", highScore);
      }
    }

    function pauseGame() {
      isPaused = true;
      pauseBtn.textContent = "Resume";
      navigator.vibrate?.(50);
    }

    function resumeGame() {
      isPaused = false;
      pauseBtn.textContent = "Pause";
      navigator.vibrate?.(50);
      animate();
    }

    pauseBtn.addEventListener("click", () => {
      isPaused ? resumeGame() : pauseGame();
    });

    retryBtn.addEventListener("click", () => {
      startGame();
    });

    // Desktop controls
    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") leftPressed = true;
      if (e.key === "ArrowRight") rightPressed = true;
    });
    window.addEventListener("keyup", (e) => {
      if (e.key === "ArrowLeft") leftPressed = false;
      if (e.key === "ArrowRight") rightPressed = false;
    });

    // Mobile buttons
    document.getElementById("leftBtn").addEventListener("touchstart", () => (leftPressed = true));
    document.getElementById("leftBtn").addEventListener("touchend", () => (leftPressed = false));
    document.getElementById("rightBtn").addEventListener("touchstart", () => (rightPressed = true));
    document.getElementById("rightBtn").addEventListener("touchend", () => (rightPressed = false));

    startGame();
  </script>
</body>
</html>

