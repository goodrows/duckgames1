<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rocket Dodger - Retro</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Press Start 2P', monospace;
      background: #000;
      color: #0f0;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    #gameArea {
      position: relative;
      width: 100vw;
      height: 100vh;
      background:
        radial-gradient(circle, #003300 0%, #000000 70%);
    }
    #rocket {
      position: absolute;
      width: 40px;
      height: 60px;
      background: #0f0;
      bottom: 20px;
      border-radius: 0; /* no curves */
      border: 3px solid #090;
      box-sizing: border-box;
    }
    .bullet {
      position: absolute;
      width: 10px;
      height: 20px;
      background: #0f0;
      border-radius: 0; /* no curves */
      border: 1px solid #060;
      box-sizing: border-box;
    }
    .powerup {
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid #0f0;
      box-sizing: border-box;
      filter: drop-shadow(0 0 2px #0f0);
    }
    .shield { background: #0ff; border-color: #0cc; }
    .points { background: #6f6; border-color: #3c3; }
    .speed { background: #fa0; border-color: #c70; }
    .freeze { background: #00f; border-color: #009; }
    .life { background: #f6a; border-color: #c60; }

    #scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 12px;
      color: #0f0;
      text-shadow: 0 0 4px #0f0;
      user-select: none;
    }
    #buttons {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 20;
      display: flex;
      gap: 10px;
      user-select: none;
    }
    #retryBtn, #pauseBtn {
      background: transparent;
      border: 2px solid #0f0;
      color: #0f0;
      padding: 8px 14px;
      font-family: 'Press Start 2P', monospace;
      font-size: 12px;
      cursor: pointer;
      text-shadow: 0 0 5px #0f0;
      user-select: none;
    }
    #retryBtn {
      display: none;
    }
    #retryBtn:hover, #pauseBtn:hover {
      background: #0f0;
      color: #000;
      text-shadow: none;
    }
    #mobileControls {
      position: absolute;
      bottom: 60px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
      user-select: none;
      pointer-events: auto;
    }
    #mobileControls button {
      width: 80px;
      height: 80px;
      font-size: 36px;
      color: #0f0;
      background: transparent;
      border: 3px solid #0f0;
      border-radius: 8px;
      cursor: pointer;
      opacity: 0.4;
      user-select: none;
      filter: drop-shadow(0 0 3px #0f0);
    }
    #mobileControls button:hover {
      opacity: 0.8;
    }
    #rightBtn {
      margin-right: 10px; /* Move left so it’s fully visible */
    }
    .trail {
      position: absolute;
      width: 8px;
      height: 8px;
      background: rgba(0, 255, 0, 0.3);
      border-radius: 50%;
      pointer-events: none;
    }
    #powerupNote {
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: #ff0;
      text-shadow: 0 0 5px #0f0;
      font-family: 'Press Start 2P', monospace;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <div id="rocket"></div>
    <div id="scoreboard">
      Score: <span id="score">0</span> |
      High: <span id="highScore">0</span> |
      Lives: <span id="lives">3</span> |
      Level: <span id="level">1</span>
    </div>
    <div id="powerupNote"></div>
    <div id="buttons">
      <button id="retryBtn">RESTART</button>
      <button id="pauseBtn">PAUSE</button>
    </div>
    <div id="mobileControls">
      <button id="leftBtn">⬅️</button>
      <button id="rightBtn">➡️</button>
    </div>
  </div>

  <audio id="bgMusic" loop src="https://cdn.pixabay.com/audio/2022/03/15/audio_bab590d1a7.mp3"></audio>
  <audio id="powerupSound" src="https://cdn.pixabay.com/audio/2022/03/24/audio_c1c86c017f.mp3"></audio>
  <audio id="hitSound" src="https://cdn.pixabay.com/audio/2022/03/21/audio_127f20a1e6.mp3"></audio>

<script>
(() => {
  const rocket = document.getElementById("rocket");
  const gameArea = document.getElementById("gameArea");
  const scoreEl = document.getElementById("score");
  const highScoreEl = document.getElementById("highScore");
  const livesEl = document.getElementById("lives");
  const levelEl = document.getElementById("level");
  const retryBtn = document.getElementById("retryBtn");
  const pauseBtn = document.getElementById("pauseBtn");
  const powerupNote = document.getElementById("powerupNote");

  const bgMusic = document.getElementById("bgMusic");
  const powerupSound = document.getElementById("powerupSound");
  const hitSound = document.getElementById("hitSound");

  let bullets = [];
  let powerups = [];
  let score = 0;
  let level = 1;
  let lives = 3;
  let highScore = localStorage.getItem("highScore") || 0;
  let bulletSpeed = 4;
  let rocketSpeed = 10;
  let leftPressed = false;
  let rightPressed = false;
  let isPaused = false;

  let lastSpawnBulletTime = 0;
  let lastSpawnPowerupTime = 0;

  let shieldActive = false;
  let doublePointsActive = false;
  let speedBoostActive = false;
  let freezeBulletsActive = false;
  let freezeTimeout;

  highScoreEl.textContent = highScore;

  function updateScore() {
    scoreEl.textContent = score;
    levelEl.textContent = level;
    livesEl.textContent = lives;
  }

  function spawnBullet() {
    const bullet = document.createElement("div");
    bullet.className = "bullet";
    const x = Math.random() * (window.innerWidth - 10);
    bullet.style.left = x + "px";
    bullet.style.top = "0px";
    gameArea.appendChild(bullet);
    bullets.push({ el: bullet, x, y: 0 });
  }

  function showPowerupNotification(text) {
    powerupNote.textContent = text;
    setTimeout(() => {
      if (powerupNote.textContent === text) powerupNote.textContent = "";
    }, 3000);
  }

  const powerupTypes = [
    {
      name: "Shield",
      class: "shield",
      activate() {
        shieldActive = true;
        showPowerupNotification("Shield Activated!");
        powerupSound.play();
        setTimeout(() => {
          shieldActive = false;
          showPowerupNotification("Shield Wore Off");
        }, 5000);
        return true;
      }
    },
    {
      name: "Double Points",
      class: "points",
      activate() {
        if (doublePointsActive) return false;
        doublePointsActive = true;
        showPowerupNotification("Double Points!");
        powerupSound.play();
        setTimeout(() => {
          doublePointsActive = false;
          showPowerupNotification("Double Points Ended");
        }, 10000);
        return true;
      }
    },
    {
      name: "Speed Boost",
      class: "speed",
      activate() {
        if (speedBoostActive) return false;
        rocketSpeed = 18;
        speedBoostActive = true;
        showPowerupNotification("Speed Boost!");
        powerupSound.play();
        setTimeout(() => {
          rocketSpeed = 10;
          speedBoostActive = false;
          showPowerupNotification("Speed Normal");
        }, 6000);
        return true;
      }
    },
    {
      name: "Freeze Bullets",
      class: "freeze",
      activate() {
        if (freezeBulletsActive) return false;
        freezeBulletsActive = true;
        showPowerupNotification("Bullets Frozen!");
        powerupSound.play();
        freezeTimeout = setTimeout(() => {
          freezeBulletsActive = false;
          showPowerupNotification("Bullets Unfrozen");
        }, 4000);
        return true;
      }
    },
    {
      name: "Extra Life",
      class: "life",
      activate() {
        lives++;
        showPowerupNotification("+1 Life");
        powerupSound.play();
        updateScore();
        return true;
      }
    }
  ];

  function spawnPowerup() {
    const type = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
    const p = document.createElement("div");
    p.classList.add("powerup", type.class);
    const x = Math.random() * (window.innerWidth - 22);
    p.style.left = x + "px";
    p.style.top = "0px";
    gameArea.appendChild(p);
    powerups.push({ el: p, type, x, y: 0 });
  }

  function createTrail() {
    const trail = document.createElement("div");
    trail.className = "trail";
    trail.style.left = rocket.offsetLeft + rocket.offsetWidth / 2 - 4 + "px";
    trail.style.top = rocket.offsetTop + rocket.offsetHeight - 4 + "px";
    gameArea.appendChild(trail);
    setTimeout(() => trail.remove(), 600);
  }

  function rectsIntersect(r1, r2) {
    return !(r2.left > r1.right ||
             r2.right < r1.left ||
             r2.top > r1.bottom ||
             r2.bottom < r1.top);
  }

  function moveRocket() {
    let x = rocket.offsetLeft;
    if (leftPressed) x -= rocketSpeed;
    if (rightPressed) x += rocketSpeed;
    // Clamp inside screen
    x = Math.max(0, Math.min(window.innerWidth - rocket.offsetWidth, x));
    rocket.style.left = x + "px";
    createTrail();
  }

  function moveBullets() {
    bullets.forEach((b, i) => {
      if (freezeBulletsActive) return;
      b.y += bulletSpeed;
      if (b.y > window.innerHeight) {
        b.el.remove();
        bullets.splice(i, 1);
        score += doublePointsActive ? 2 : 1;
        updateScore();
      } else {
        b.el.style.top = b.y + "px";

        // Collision with rocket
        const rocketRect = rocket.getBoundingClientRect();
        const bulletRect = b.el.getBoundingClientRect();
        if (rectsIntersect(rocketRect, bulletRect)) {
          if (shieldActive) {
            shieldActive = false;
            showPowerupNotification("Shield Absorbed Hit");
            powerupSound.play();
          } else {
            hitSound.play();
            lives--;
            updateScore();
            if (lives <= 0) endGame();
          }
          b.el.remove();
          bullets.splice(i, 1);
        }
      }
    });
  }

  function movePowerups() {
    powerups.forEach((p, i) => {
      p.y += 2;
      if (p.y > window.innerHeight) {
        p.el.remove();
        powerups.splice(i, 1);
      } else {
        p.el.style.top = p.y + "px";
        // Collision with rocket
        const rocketRect = rocket.getBoundingClientRect();
        const powerupRect = p.el.getBoundingClientRect();
        if (rectsIntersect(rocketRect, powerupRect)) {
          // Activate powerup, if it returns true remove it
          if (p.type.activate()) {
            p.el.remove();
            powerups.splice(i, 1);
          }
        }
      }
    });
  }

  function increaseLevel() {
    level++;
    bulletSpeed += 1;
    showPowerupNotification("Level Up! Speed increased");
    updateScore();
  }

  let lastLevelUpScore = 0;

  function gameLoop(time) {
    if (isPaused) {
      requestAnimationFrame(gameLoop);
      return;
    }

    moveRocket();
    moveBullets();
    movePowerups();

    // Spawn bullets every 600ms approx
    if (!lastSpawnBulletTime || time - lastSpawnBulletTime > 600) {
      spawnBullet();
      lastSpawnBulletTime = time;
    }

    // Spawn powerups every 8000ms approx
    if (!lastSpawnPowerupTime || time - lastSpawnPowerupTime > 8000) {
      spawnPowerup();
      lastSpawnPowerupTime = time;
    }

    // Level up every 25 points
    if (score - lastLevelUpScore >= 25) {
      lastLevelUpScore = score;
      increaseLevel();
    }

    requestAnimationFrame(gameLoop);
  }

  function resetGame() {
    // Remove bullets and powerups
    bullets.forEach(b => b.el.remove());
    bullets = [];
    powerups.forEach(p => p.el.remove());
    powerups = [];

    score = 0;
    level = 1;
    lives = 3;
    bulletSpeed = 4;
    rocketSpeed = 10;
    shieldActive = false;
    doublePointsActive = false;
    speedBoostActive = false;
    freezeBulletsActive = false;
    clearTimeout(freezeTimeout);

    retryBtn.style.display = "none";
    pauseBtn.style.display = "inline-block";
    isPaused = false;

    rocket.style.left = (window.innerWidth / 2 - rocket.offsetWidth / 2) + "px";
    updateScore();
    powerupNote.textContent = "";

    bgMusic.currentTime = 0;
    bgMusic.play();
  }

  function endGame() {
    isPaused = true;
    retryBtn.style.display = "inline-block";
    pauseBtn.style.display = "none";
    bgMusic.pause();
    if (score > highScore) {
      highScore = score;
      localStorage.setItem("highScore", highScore);
      highScoreEl.textContent = highScore;
      alert("New High Score: " + highScore);
    }
    powerupNote.textContent = "Game Over! Press RESTART";
  }

  retryBtn.addEventListener("click", resetGame);

  pauseBtn.addEventListener("click", () => {
    if (isPaused) {
      isPaused = false;
      pauseBtn.textContent = "PAUSE";
      bgMusic.play();
    } else {
      isPaused = true;
      pauseBtn.textContent = "RESUME";
      bgMusic.pause();
    }
  });

  // Keyboard controls
  window.addEventListener("keydown", e => {
    if (e.code === "ArrowLeft" || e.code === "KeyA") leftPressed = true;
    if (e.code === "ArrowRight" || e.code === "KeyD") rightPressed = true;
  });
  window.addEventListener("keyup", e => {
    if (e.code === "ArrowLeft" || e.code === "KeyA") leftPressed = false;
    if (e.code === "ArrowRight" || e.code === "KeyD") rightPressed = false;
  });

  // Mobile controls
  const leftBtn = document.getElementById("leftBtn");
  const rightBtn = document.getElementById("rightBtn");
  leftBtn.addEventListener("touchstart", e => { e.preventDefault(); leftPressed = true; });
  leftBtn.addEventListener("touchend", e => { e.preventDefault(); leftPressed = false; });
  rightBtn.addEventListener("touchstart", e => { e.preventDefault(); rightPressed = true; });
  rightBtn.addEventListener("touchend", e => { e.preventDefault(); rightPressed = false; });

  // Initialize position
  rocket.style.left = (window.innerWidth / 2 - rocket.offsetWidth / 2) + "px";

  // Start music & game loop
  bgMusic.volume = 0.3;
  bgMusic.play();

  updateScore();
  requestAnimationFrame(gameLoop);

})();
</script>
</body>
</html>
